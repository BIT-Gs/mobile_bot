<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Robot Controller</title>
    <script src="https://unpkg.com/eventemitter2@6.4.6/lib/eventemitter2.js"></script>
    <script src="https://unpkg.com/roslib@1.3.0/build/roslib.min.js"></script>
</head>
<body>
    <h1>Control Your Robot</h1>

    <button id="forward">Forward</button>
    <button id="backward">Backward</button>
    <button id="left">Left</button>
    <button id="right">Right</button>
    <button id="stop">Stop</button>

    <script type="text/javascript">
        // 连接到rosbridge WebSocket服务器
        var ros = new ROSLIB.Ros({
            url: 'ws://192.168.37.128:9090'
        });

        ros.on('connection', function() {
            console.log('Connected to websocket server.');
        });

        ros.on('error', function(error) {
            console.log('Error connecting to websocket server: ', error);
        });

        ros.on('close', function() {
            console.log('Connection to websocket server closed.');
        });

        // 创建一个发布者，发布到 /diff_controller/cmd_vel_unstamped 话题
        var cmdVel = new ROSLIB.Topic({
            ros: ros,
            name: '/diff_controller/cmd_vel_unstamped',
            messageType: 'geometry_msgs/msg/Twist'
        });

        // 生成 Twist 消息
        function createTwist(linearX, angularZ) {
            return new ROSLIB.Message({
                linear: {
                    x: linearX,
                    y: 0.0,
                    z: 0.0
                },
                angular: {
                    x: 0.0,
                    y: 0.0,
                    z: angularZ
                }
            });
        }

        // 绑定按钮事件
        document.getElementById('forward').onclick = function() {
            cmdVel.publish(createTwist(0.5, 0.0));
        };

        document.getElementById('backward').onclick = function() {
            cmdVel.publish(createTwist(-0.5, 0.0));
        };

        document.getElementById('left').onclick = function() {
            cmdVel.publish(createTwist(0.0, 0.5));
        };

        document.getElementById('right').onclick = function() {
            cmdVel.publish(createTwist(0.0, -0.5));
        };

        document.getElementById('stop').onclick = function() {
            cmdVel.publish(createTwist(0.0, 0.0));
        };
    </script>
</body>
</html>
